(function(){function n(n,r){return a.call(n,r)}function r(n){return"function"==typeof n}function t(n){return"string"==typeof n}function e(){var r=[].slice.apply(arguments,[0]).reduce(function(n,r){return t(r)?n.push({selector:r}):n[n.length-1].fn=r,n},[]);return function(t,e){var u=this;r.some(function(r){return n(u,r.selector)?(r.fn.apply(u,[t,e]),!0):void 0})}}function u(){function n(n,t){return r(n)||(n=function(){}),function(r){t.body=r,n(!1,t)}}function t(n,r){return{uri:n,params:r}}var e,u={},i={};return u.resource=function(n,r,t){return 1==arguments.length?i[n]:(2==arguments.length&&(t=r,r=n),i[n]={name:n,ptn:r,handler:t},rhumb.add(r,function(n){return{fn:t,params:n}}),u)},u.req=function(i,a){var f=rhumb.match(i);if(!f)throw Error("no match");var o=t(i,f.params),c=t(i,f.params),p=[o],s=f.fn,l=!1;s.length>1?p.push(n(a,c)):l=!0;var m=this instanceof HTMLElement?this:e;return s.apply(m,p),l&&r(a)&&a(),u},u.view=function(n){return arguments.length?(e=n,u):e},u.uri=function(n,r){var t=i[n];if(!t)throw Error(n+" not found");var e=rhumb.parse(t.ptn);return e.reduce(function(n,t){return"var"==t.type?[n,r[t.input.substr(1)]].join("/"):[n,t.input].join("/")},"")},u}nap={},nap.web=u,nap.negotiate={bySelector:e};var i=document.documentElement,a=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector})(),function(){function n(n,r){var t={},e=function(n,r){var u=n.shift();if(!u)return r.leaf||!1;if(r.fixed&&u in r.fixed)return e(n,r.fixed[u]);if(r.partial){var i=r.partial,a=i.some(function(n){return n.ptn.test(u)?(r=n.node,!0):void 0});if(a)return e(n,r)}return r.var?(t[r.var.name]=u,e(n,r.var)):!1},u=e(n,r,t);return u?{fn:u,params:t}:!1}function r(){var r={},e={},u=function(n,r,t){var e,i=n.shift(),a=!!n.length;if(i)if("fixed"==i.type)r.fixed||(r.fixed={}),e=r.fixed[i.input]||(r.fixed[i.input]={}),a?u(n,e,t):e.leaf=t;else{if("var"!=i.type)throw Error("not yet!");e=r.var||(r.var={}),e.name=i.input.substr(1),a?u(n,e,t):e.leaf=t}};return r.add=function(n,r){u(t(n),e,r)},r.match=function(r){var t=r.split("/").filter(function(n){return!!n}),u=n(t,e);return u?u.fn.apply(u.fn,[u.params]):void 0},r}function t(n){var r=n.split("/").filter(function(n){return!!n}).map(function(n){var r=":"==n[0]?"var":"fixed";return{type:r,input:n}});return r}rhumb=r(),rhumb.create=r,rhumb.parse=t,rhumb._findInTree=n}();