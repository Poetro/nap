<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script type="text/javascript" src="../components/rhumb/rhumb.js"></script>
  <script type="text/javascript" src="../src/nap.js"></script>
  <script type="text/javascript" src="../lib/d3/d3.js"></script>
  
  <script type="text/javascript">
    function init(){
      var list = ["this", "that"]

      function addTodo(req, res){
        list.push(req.body), res()
      }

      function todos(req){
        var sel = d3.select(this)
          .selectAll("li")
          .data(list, function(d){return d})

        sel.enter().append("li")
          .text(function(d){return d})

        sel.exit().remove()
      }

      var web = nap.web()
        .view(d3.select(".container").node())
        .resource("/todos", 
          nap.negotiate.ordered(
            nap.negotiate.using("body", addTodo)
          , todos
          )
        )

      
      function render(){
        var req = web.req.bind(
          d3.select("ul").node()
        )
        req("/todos")
      }

      render()

      d3.select("form")
        .on("submit", function(){
          d3.event.preventDefault()
          var input = this
          web.req(
            { uri : "/todos" , body : input.todo.value }
          , function(err, data){
              input.todo.value = ""
              render()
            }
          )
        })
    }
  </script>
  <title>Bodies</title>
</head>
<body onload="init()">
  <div class="container">

    <ul>
      <li></li>
    </ul>

    <form>
      <input name="todo" type="text"></input>
    </form>
  </div>
</body>
</html>